(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const U=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},W=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},Z=(e,t,o)=>{if(t.validity.patternMismatch&&t.dataset.errorMessage){U(e,t,t.dataset.errorMessage,o);return}t.validity.valid?W(e,t,o):U(e,t,t.validationMessage,o)},ee=e=>e.some(t=>!t.validity.valid),H=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},te=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{ee(e)?H(t,o):te(t,o)},oe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);A(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{Z(e,r,t),A(o,n,t)})})},m=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{W(e,r,t)}),H(n,t)},re=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{oe(o,e)})},a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"e8bf85c5-4a5a-4fcd-ad91-bbb20760f63e","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ne=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(u),j=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(u),ce=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(u),se=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(u),ae=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(u),ie=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(u),le=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(u),ue=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),J=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r},c)=>{const s=ue(),P=s.querySelector(".card__like-count"),v=s.querySelector(".card__like-button");e.likes?.some(C=>C._id===c)&&v.classList.add("card__like-button_is-active");const w=s.querySelector(".card__control-button_type_delete"),q=s.querySelector(".card__image");q.src=e.link,q.alt=e.name,s.querySelector(".card__title").textContent=e.name,P.textContent=e.likes.length,e.owner?._id!==c?w.remove():w.addEventListener("click",()=>n(e._id,s)),o&&v.addEventListener("click",()=>{const C=v.classList.contains("card__like-button_is-active");o(e._id,C,v,P)}),t&&q.addEventListener("click",()=>t({name:e.name,link:e.link}));const T=s.querySelector(".card__control-button_type_info");return r&&T&&T.addEventListener("click",()=>r(e._id)),s},R=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",R)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",R)},pe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})},V=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),h=g.querySelector(".popup__form"),z=h.querySelector(".popup__input_type_name"),K=h.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),i=k.querySelector(".popup__form"),de=i.querySelector(".popup__input_type_card-name"),_e=i.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),$=E.querySelector(".popup__image"),fe=E.querySelector(".popup__caption"),me=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_edit-avatar"),l=x.querySelector(".popup__form"),he=l.querySelector(".popup__input"),D=h.querySelector(".popup__button"),F=l.querySelector(".popup__button"),N=i.querySelector(".popup__button"),S=document.querySelector(".popup_type_info"),Se=S.querySelector(".popup__title"),f=S.querySelector(".popup__info"),ve=S.querySelector(".popup__text"),O=S.querySelector(".popup__list"),be=document.querySelector("#popup-info-definition-template").content,Le=document.querySelector("#popup-info-user-preview-template").content;let L;const _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},d=(e,t,o,n)=>{e.textContent=t?n:o};re(_);const G=({name:e,link:t})=>{$.src=t,$.alt=e,fe.textContent=e,y(E)},qe=e=>{e.preventDefault(),d(D,!0,"Сохранить","Сохранение..."),ce({name:z.value,about:K.value}).then(t=>{I.textContent=t.name,B.textContent=t.about,p(g)}).catch(t=>{console.log(t)}).finally(()=>{d(D,!1,"Сохранить","Сохранение...")})},Ce=e=>{e.preventDefault(),d(F,!0,"Сохранить","Сохранение..."),se(he.value).then(t=>{M.style.backgroundImage=`url(${t.avatar})`,l.reset(),m(l,_),p(x)}).catch(t=>{console.log(t)}).finally(()=>{d(F,!1,"Сохранить","Сохранение...")})},ge=e=>{e.preventDefault(),d(N,!0,"Создать","Создание..."),ae({name:de.value,link:_e.value}).then(t=>{V.prepend(J(t,{onPreviewPicture:G,onLikeIcon:Y,onDeleteCard:X,onInfoClick:Q},L)),i.reset(),m(i,_),p(k)}).catch(t=>{console.log(t)}).finally(()=>{d(N,!1,"Создать","Создание...")})};h.addEventListener("submit",qe);i.addEventListener("submit",ge);l.addEventListener("submit",Ce);me.addEventListener("click",()=>{z.value=I.textContent,K.value=B.textContent,m(h,_),y(g)});M.addEventListener("click",()=>{l.reset(),m(l,_),y(x)});ye.addEventListener("click",()=>{i.reset(),m(i,_),y(k)});const Q=e=>{j().then(t=>{const o=t.find(n=>n._id===e);o&&(f.innerHTML="",O.innerHTML="",Se.textContent="Информация о карточке",ve.textContent="Лайкнули:",f.append(b("Описание:",o.name)),f.append(b("Дата создания:",Ee(new Date(o.createdAt)))),f.append(b("Владелец:",o.owner?.name??"—")),f.append(b("Количество лайков:",String(o.likes.length))),o.likes.forEach(n=>{O.append(Ie(n))}),y(S))}).catch(t=>{console.log(t)})},ke=document.querySelectorAll(".popup");ke.forEach(e=>{pe(e)});Promise.all([j(),ne()]).then(([e,t])=>{L=t._id,I.textContent=t.name,B.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{V.append(J(o,{onPreviewPicture:G,onLikeIcon:Y,onDeleteCard:X,onInfoClick:Q},L))})}).catch(e=>{console.log(e)});const X=(e,t)=>{ie(e).then(()=>{t.remove()}).catch(o=>{console.log(o)})},Y=(e,t,o,n)=>{le(e,t).then(r=>{const c=r.likes.some(s=>s._id===L);o.classList.toggle("card__like-button_is-active",c),n.textContent=r.likes.length}).catch(r=>{console.log(r)})},Ee=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),b=(e,t)=>{const o=be.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Ie=e=>{const t=Le.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e.name,t};
